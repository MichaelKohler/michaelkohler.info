<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>Alpha Review - Using Janitor to contribute to Firefox</title>
  <meta name="author" content="Michael Kohler">
  <meta name="description" content="At the Firefox Hackathon in Zurich we used The Janitor to contribute to Firefox. It’s important to note that it’s still in alpha and invite-only.

The">
  
  
  <meta property="og:title" content="Alpha Review - Using Janitor to contribute to Firefox"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Michael Kohler"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Michael Kohler" type="application/atom+xml">
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta name="generator" content="Hexo 5.0.1"></head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="behind">
      <a href="/" class="back black-color">
        <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M2 30 L30 2 M30 30 L2 2"></path>
        </svg>
      </a>
      <div class="description">
        &nbsp;Personal Blog
      </div>
    </div>
    <div class="container">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        Alpha Review - Using Janitor to contribute to Firefox
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2016-05-05T15:02:12.000Z">
<svg class="i-calendar" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2016-05-05
</time>



    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/categories/Mozilla/">Mozilla</a>




    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="14" height="14" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/tags/Mozilla/">Mozilla</a>·<a href="/tags/mozillareps/">mozillareps</a>·<a href="/tags/MozillaCH/">MozillaCH</a>


    </div>
    <hr>
    <div class="picture-container">
      
    </div>
    <p>At the <a href="https://michaelkohler.info/2016/firefox-hackathon-zurich-april-2016">Firefox Hackathon in Zurich</a> we used <a target="_blank" rel="noopener" href="http://janitor.technology/">The Janitor</a> to contribute to Firefox. It’s important to note that it’s still in alpha and invite-only.</p>
<p><a href="/2016/05/Screen-Shot-2016-05-05-at-14.37.23.png"><img src="/2016/05/Screen-Shot-2016-05-05-at-14.37.23.png" alt="Screen Shot 2016-05-05 at 14.37.23"></a></p>
<p>The Janitor was started by <a target="_blank" rel="noopener" href="https://mozillians.org/en-US/u/janx/">Jan Keromnes</a>, a Mozilla employee. While still in an alpha state, Jan gave us access to it so we could test run it at our hackathon. Many thanks to him for spending his Saturday on IRC and helping us out with everything!</p>
<p>Once you’re signed up, you can click on “Open in Cloud9” and directly get to the <a target="_blank" rel="noopener" href="http://c9.io/">Cloud9 editor</a> who kindly sponsor the premium accounts for this project. <span class="message"><span class="content">Cloud9 is a pure-web IDE based on real Linux environments, with an insanely fast editor</span></span>.</p>
<p><a href="/2016/05/Screen-Shot-2016-05-05-at-14.38.23.png"><img src="/2016/05/Screen-Shot-2016-05-05-at-14.38.23.png" alt="Screen Shot 2016-05-05 at 14.38.23"></a></p>
<p><a href="/2016/05/Screen-Shot-2016-05-05-at-14.38.50.png"><img src="/2016/05/Screen-Shot-2016-05-05-at-14.38.50.png" alt="Screen Shot 2016-05-05 at 14.38.50"></a></p>
<p>At the hackathon we ran into a Cloud9 “create workspace” limitation, but according to Jan this should be fixed now.</p>
<p><strong>Setting up</strong></p>
<p>After an initial “git pull origin master” in the Cloud9 editor terminal, you can start to build Firefox in there. Simply running “./mach build” is enough. For me this took about 12 minutes for the first time, while my laptop still needs more than 50 minutes to compile Firefox. This is definitely an improvement. Further you won’t need anything else than a browser!</p>
<p>I had my environment ready in about 15 minutes if you count the time to compile Firefox. Comparing this to my previous setups, this solves a lot of dependency-hell problems and is also way faster.</p>
<p><strong>Running the newly compiled Firefox</strong></p>
<p>The Janitor includes a VNC viewer which opens a new tab and you can run your compiled Firefox in there. You can start a shell and run “./mach run” in the Firefox directory and you can start testing your changes.</p>
<p><a href="/2016/05/Screen-Shot-2016-05-05-at-14.49.08.png"><img src="/2016/05/Screen-Shot-2016-05-05-at-14.49.08.png" alt="Screen Shot 2016-05-05 at 14.49.08"></a></p>
<p><a href="/2016/05/Screen-Shot-2016-05-05-at-14.50.20.png"><img src="/2016/05/Screen-Shot-2016-05-05-at-14.50.20.png" alt="Screen Shot 2016-05-05 at 14.50.20"></a></p>
<p><strong>Running ESLint</strong></p>
<p>For some of the bugs we tackled at the hackathon, we needed to run ESLint (well, would be good to run this anyway, no matter what part of the code base you’re changing). The command looks like this:</p>
<pre><code>user@e49de5f6914e:~/firefox$ ./mach eslint --no-ignore devtools/client/webconsole/test/browser_webconsole_live_filtering_of_message_types.js
0:00.40 Running /usr/local/bin/eslint
0:00.40 /usr/local/bin/eslint --plugin html --ext [.js,.jsm,.jsx,.xml,.html] --no-ignore devtools/client/webconsole/test/browser_webconsole_live_filtering_of_message_types.js

/home/user/firefox/devtools/client/webconsole/test/browser_webconsole_live_filtering_of_message_types.js
8:1   warning  Could not load globals from file browser/base/content/browser-eme.js: Error: ENOENT: no such file or directory, open &#39;/home/user/firefox/browser/base/content/browser-eme.js&#39;  mozilla/import-browserjs-globals
8:1   warning  Definition for rule &#39;mozilla/import-globals&#39; was not found                                                                                                                     mozilla/import-globals
8:1   error    Definition for rule &#39;keyword-spacing&#39; was not found                                                                                                                            keyword-spacing
18:17  error    content is a possible Cross Process Object Wrapper (CPOW)                                                                                                                      mozilla/no-cpows-in-tests

✖ 4 problems (2 errors, 2 warnings)

0:02.85 Finished eslint. Errors encountered.</code></pre>
<p>As you might see from the input, running this in the Janitor environment results in not finding the Mozilla-specific rules. The reason here is that the eslint npm package is installed globally. Globally installed eslint can’t find the locally installed mozilla-eslint-plugin. In my opinion the easiest fix would be to not install it globally, just within the firefox directory (running “./mach eslint –setup”) while spinning up the instance should be enough here.</p>
<p>We could circumvent this problem by changing the global npm prefix and then running it with “/new/path/eslint …” so it doesn’t call the other one. In hindsight, we could just have installed it to the directory and then call it through node_modules.</p>
<p><strong>Update, May 5, 15:09:</strong> Jan has has fixed this plugin issue :)</p>
<p><strong>Creating a patch</strong></p>
<p>Creating a patch is really easy, following the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Mercurial/Using_Mercurial#I%27m_all_used_to_Git_but_how_can_I_provide_Mercurial-ready_patches">tutorial on MDN</a> is enough. We were very happy to see that the moz-git-tools are already installed by default, so you can just create your own branch, checkin your changes and run “git format-patch -p -k master” to get a Git patch file. Since we need a Mercurial patch, you then run “git-patch-to-hg-patch” and you can upload the resulting file to Bugzilla and you’re set!</p>
<p>Those two commands could maybe be aliased by default so running “create-patch” or similar would directly do this for you to further decrease the work you need to do manually.</p>
<p><strong>Seeing it in action</strong></p>
<p>[embed]<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=5sNDMIh-iVw%5B/embed%5D">https://www.youtube.com/watch?v=5sNDMIh-iVw[/embed]</a></p>
<p><strong>Conclusion</strong></p>
<p>After some initial account problems, we didn’t really find any other bugs apart from the ESLint situation. Again, thanks a lot to Jan for providing us the environment and letting us test it. This will change the live of a lot of contributors! For now The Janitor supports contributions to Firefox, Chrome, Thunderbird, Servo and KDE. There is also a <a target="_blank" rel="noopener" href="https://github.com/jankeromnes/janitor">GitHub repository</a> for it.</p>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  <div class="busuanzi center">
    page PV:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    site PV:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    site UV:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>




    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot container">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        
    </div>
    <div class="secondrow">
        <a href="">
        
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script src="https://cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.min.js"></script>
<script type="text/javascript">

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script>

</body>
</html>
